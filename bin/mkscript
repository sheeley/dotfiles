#! /usr/bin/env nu

let scriptDir = $"($env.HOME)/dotfiles/templates/scripts/"
let supportedTypes = ls ($scriptDir | path join script.* | into glob) | each {|e| $e.name | path parse} | get extension

def main [
	scriptName: string, # name of script to create
	--local = false # create in current directory
	--shell: string = bash # shell to use - ls ~/dotfiles/templates/scripts/
	] {
	if ($supportedTypes not-has $shell) {
		"Valid shells: " | print
		$supportedTypes | print 
		exit 1
	}

	let scriptDir = $"($env.HOME)/dotfiles/bin/"
	if $local {
		let scriptDir = (pwd)
	}

	let file = $"($scriptDir)/($scriptName)"

	if ($file | path exists) {
		echo "script exists"
		exit 1
	}

 	open $"($env.HOME)/dotfiles/templates/scripts/script.($shell)" | save $file
	chmod +x $file

	if $env.TERM != "" {
		^$env.EDITOR $file
	}
}

