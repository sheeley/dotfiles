#! /usr/bin/env bash
set -euo pipefail # x

(
    cd "$PRIVATE_TOOLS_DIR"
    ./bin/sieve.swift | tee aigee-mail.sieve | pbcopy
    if [ $# -gt 0 ]; then
        # skip for local testing
        exit 0
    fi
    echo "sieve copied"
    open "https://www.fastmail.com/settings/rules/sieve?u=9619409e"
)

# TODO: validate email rules

# sieve_gen skip
# SIEVE="$PRIVATE_TOOLS_DIR/aigee-mail.sieve"
# TMP_SIEVE=$(mktemp)
# cp "$SIEVE" "$TMP_SIEVE"
# sed -i'' -e 's/# require/require/' "$TMP_SIEVE"

# sieve-test "$TMP_SIEVE" "$1"
