#! /etc/profiles/per-user/johnnysheeley/bin/nu

let host = "192.168.1.196"
let url = $"http://($host):9123/elgato/lights"

def main [
  on: string = "toggle" # On or off
] {
  mut isOn = 0
  if $on == "toggle" {
    let alreadyOn = ((http get $url) | get lights.0.on)
  	if $alreadyOn == 0 {
  		$isOn = 1
  	}
  } else if $on == "on" {
    $isOn = 1
  }
  
  let payload = { numberOfLights: 1, lights: [{ on: $isOn}]}
  http put --content-type application/json $url $payload
}
