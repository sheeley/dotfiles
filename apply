#! /usr/bin/env bash
set -eu

HN=$(hostname | cut -d '.' -f 1)
if [[ "$HN" != "jmba" && "$HN" != "Sheeley-MBP" ]]; then
    echo "change hostname: $HN"
    exit 1
fi

# TODO: move to nix?
mkdir -p "~/.ssh/control" 
mkdir -p "~/Screenshots" 
mkdir -p "~/projects/sheeley" 
mkdir -p "~/bin"

nix build .#darwinConfigurations.${HN}.system --impure --extra-experimental-features "nix-command flakes"

echo "darwin-rebuild"
./result/sw/bin/darwin-rebuild switch --flake . --impure
